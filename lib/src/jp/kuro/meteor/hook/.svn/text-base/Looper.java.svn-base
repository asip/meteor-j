package jp.kuro.meteor.hook;

import jp.kuro.meteor.Element;
import jp.kuro.meteor.Parser;

import java.util.List;

/**
 * ループ専用フック処理クラス
 * @author Yasumasa Ashida
 * @since 2006/04/16 19:37:20
 */
public abstract class Looper {

   /**
     * フック処理(実体-値渡し-)
     *
     * @param elm  Tagオブジェクト
     * @param pif   Parserオブジェクト
     * @param list Listオブジェクト
     */
    public final void doAction(Element elm, Parser pif, List list) {
        //要素ありタグの場合
        if (elm.empty()) {
            Parser pif2 = pif.getChildParser(elm);

            for (int i = 0; i < list.size(); i++) {

                if(pif2.getRootElement().isHook()){
                    pif2.getRootElement().setDocument(elm.getContent());
                }else if(pif2.getRootElement().isMonoHook()){
                    //pif2.getRootElement().setDocument(elm.getDocument());
                }
                execute(pif2, list.get(i));
            }
            pif.replace(elm, pif2.getRootElement().getHookDocument().toString());

            //todo
            //System.out.println(pif2.getHookDocument());
        }
    }

    /**
     * フック処理を実装する
     *
     * @param pif  Parserオブジェクト
     * @param obj Objectオブジェクト
     */
    public abstract void execute(Parser pif, Object obj);

}
